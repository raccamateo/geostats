---
title: "Principios de Estadística Espacial"
author: "Mateo W. Racca"
date: "`r format(Sys.time(), '%d/%m/%y')`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    theme: sandstone
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Geoestadística

Se ocupa de la modelización, predicción y simulación de fenómenos continuos en el espacio utilizando un método de interpolación espacial que considera la estructura espacial de estos fenómenos, llamado Kriging.
Ya que la geoestadística solo se limita a este enfoque, al abordar otros métodos de interpolación sería conveniente hablar de Estadística Espacial.

Esta pequeña guía se basa en Geostatistics for Environmental Scientists, de Richard Webster y Margaret A. Oliver (DOI:10.1002/9780470517277) y en apuntes de clases del posgrado en Big Data y Desarrollo Territorial de FLACSO Argentina (2020).

## Autocorrelación Espacial

En general, cosas que están próximas son similares entre sí. Esto fue postulado por Fisher en 1935, al observar que lotes próximos tenían rendimientos más similares que aquellos que estaban alejados. Fue el primero en aplicar conceptos de autocorrelación espacial para la siembra de ensayos, aunque no se hablaba de desagregar por proximidad o si era por otros factores.

En 1970, Tobler busca resolver problemas del crecimiento urbano en Detroit y retoma las ideas de Fisher para analizar la expansión en lugares urbanos próximos. La Primera Ley de Tobler postula que todo está relacionado con todo, pero que las cosas más cercanas están más relacionadas que las distantes.

## Espacialización

Basado en los conceptos de la autocorrelación espacial, el proceso de Espaciaalización permite generar estructuras de datos espaciales con cobertura continua a partir de datos espacialmente discontinuos o discretos mediante interpolación espacial. Es decir, puntos aislados de dimensión cero son llevados a dos dimensiones.

# Interpolación Espacial

Es uno de los procesos de espacialización en el que se observa un fenómeno Z en un número limitado de lugares X (puntos muestreales o de observación/registro). Sirve para conocer el valor de una propiedad en cierta superficie. 

Hay diferencias entre los principios de la estadística tradicional y la geoestadística. Mientras que el enfoque clásico utiliza muestreos aleatorios para estimar parámetros de la población, en geoestadística ya existen valores reales (lo que se mide u observa) que consideran e incorporan características y a su vez tienen aleatoriedad y cumplen con el principio de autocorrelación. Trata de inferir aquello que se desconoce en base a lo mencionado recién.

Todos los métodos de predicción local pueden ser vistos como algún tipo de promedio ponderado donde:


<center>
![](https://raw.githubusercontent.com/raccamateo/geostats/main/0.png){width=25%}
</center>


## Métodos de interpolación
 
 Pueden ser:
 
 * ***Exactos***, cuando los valores medidos forman parte de la solución.
 
 * ***Inexactos*** o estimados, cuando los valores medidos no forman parte de la solución.
 
 A continuación se explicarán los métodos más comunes.
 
### Polígonos de Voronoi o Thiessen

Hay una serie *N* de puntos generadores *z* que dividen una región en *N* polígonos o teselas *V*, esto quiere decir que hay tantos polígonos como puntos generadores. 

La división de la región es a través de bisectores perpendiculares (líneas) que se forman al calcular las distancias entre puntos. Estas particiones dividen el espacio entre puntos generadores, y como resultado el espacio interno de estos polígonos contiene todos los puntos cuya distancia al punto generador es menor que la distancia a cualquier otro punto externo.


<center>
![By Balu Ertl - Own work, CC BY-SA 4.0, https://commons.wikimedia.org/w/index.php?curid=38534275](https://raw.githubusercontent.com/raccamateo/geostats/main/1.png){width=30%}
</center>


En este tipo de interpolación, todo lo que corresponde a un polígono toma el/los valor/es del punto generador. Los polígonos que comparten borde, son llamados *vecinos*. 

Otra característica es que los polígonos llenan completamente el espacio sin superposición. Es un interpolador exacto, lo que quiere decir que no hay estimación de error y que no se usa información de lugares vecinos.

### Triangulación de Delaunay o Teselado de Dirichlet

Es un diagrama dual de los Polígonos de Voronoi, se construyen uniendo pares de puntos generadores de aquellos polígonos que comparten los mismos bordes. Acá sí importan los vecinos.


<center>
![Hferee, CC BY-SA 3.0 <https://creativecommons.org/licenses/by-sa/3.0>, via Wikimedia Commons](https://raw.githubusercontent.com/raccamateo/geostats/main/2.png){width=25%}
</center>


Tal como se puede ver, la Triangulación de Delaunay (en negro) y el Diagrama de Voronoi (en rojo) a partir de una serie de puntos.

Los triángulos no se superponen. Este método se usa para hacer interpolaciones lineales entre vértices, y es exacto. Permite gradientes abruptos y utiliza 3 puntos de datos.

Nos permite usar interpolación lineal para calcular la diferencia entre valores de puntos en el espacio, y como se conoce el ángulo de inclinación se pueden espacializar datos de altura para generar curvas de nivel.

### Vecinos Naturales

Es una variante de Voronoi. Sobre un teselado se inserta un lugar a predecir *x0* y se recalcula el polígono. Esto quita arbitrareidad.

La proporción de áreas de intersección con los polígonos originales se usa para estimar los pesos. Estos pesos son siempre positivos, y la suma de todos siempre da 1.


<center>
![Markluffel, CC BY-SA 3.0 <https://creativecommons.org/licenses/by-sa/3.0>, via Wikimedia Commons](https://raw.githubusercontent.com/raccamateo/geostats/main/3.png){width=25%}
 </center>


Es también un interpolador exacto, por lo que no hay medida de error. Permite lograr gradientes suaves. Incorpora información sobre el vecindario pero no usa puntos lejanos, necesita que los datos no sean ruidosos, es decir que no funciona bien cuando hay muchas variaciones.


### Distancia Inversa Ponderada (IDW)

Cada punto tiene influencia local que disminuye con la distancia. 


<center>
![https://pro.arcgis.com/es/pro-app/help/analysis/geostatistical-analyst/how-inverse-distance-weighted-interpolation-works.htm](https://raw.githubusercontent.com/raccamateo/geostats/main/4.png){width=30%}
</center>


El valor a predecir se calcula usando una combinación lineal ponderada de los vectores muestreados. A mayor proximidad al lugar a predecir, mayor peso tendran los puntos vecinos.


<center>
![https://pro.arcgis.com/es/pro-app/help/analysis/geostatistical-analyst/how-inverse-distance-weighted-interpolation-works.htm](https://raw.githubusercontent.com/raccamateo/geostats/main/5.png){width=25%}
</center>
  

Ahora vamos a la ecuación que nos permite calcular superficies usando IDW y a un gráfico de ejemplo sobre cómo se ajusta según puntos muestrales:


<center>
![https://pro.arcgis.com/es/pro-app/help/analysis/geostatistical-analyst/how-inverse-distance-weighted-interpolation-works.htm](https://raw.githubusercontent.com/raccamateo/geostats/main/6.png){width=40%}
</center>


Cuando *x0* coincide con cualquier *xi*, el peso *λ* se hace infinito y entonces se le asigna el valor de *xi*.

Para obtener mínimos y máximos a través del gradiente, necesitamos que los lugares tengan valores. En todos los casos en los que no hay datos, el gradiente no puede ser calculado, por lo que su valor es 0.

Es un interpolador exacto en el que la elección del exponente (β) es arbitraria. No se tiene en cuenta la configuración espacial de las muestras.

Este método es usado cuando el conjunto de puntos muestrales es denso y captura la extensión de la variación de la superficie.
  

TERMINAR 

### Splines o curvas adaptativas

Se interpola localmente con ponlinomios usando puntos de valores conocidos. El objetivo es minimizar la curvatura general de la superficie a estimar. Es ampliamente usado para generar superficies con variaciones leves, como superficies de elevación o de concentraciones de contaminación.

Los puntos de unión entre curvas son llamados nudos o knots. 

Tipos de Spline:

* ***Regularized o Regularizado***: el objetivo es lograr una superficie suave y las curvas toman valores que pueden estar fuera del rango de los datos de muestra.
 
 * ***Tension o de Tensión***: se busca controlar la rigidez de la superficie en función del caracter de lo que modelamos. Crea una superficie menos suave con valores más restringidos por el rango de datos de la muestra.


<center>
![https://www.neonscience.org/resources/learning-hub/tutorials/spatial-interpolation-basics](https://raw.githubusercontent.com/raccamateo/geostats/main/7.png){width=40%}
</center>


Spline es bueno para estimar valores fuera del rango de puntos muestrales y para crear superficies suaves y continuas, pero no es bueno para trabajar con puntos cercanos que tienen valores muy distintos entre sí. Los cálculos de pendientes pueden generar sobreestimación o subestimación. 


### Kriging
